SCREEN $80
RECT 0,0,319,239,0
GOSUB SETREGVARS
GOSUB POKEMODE
CLS
COLOR 1,0
LOCATE 2,2
PRINT "ABOUT TO TRY TO CHANGE TO MODE 1"
LOCATE 3,2:
PRINT "WITH NO FLICKER..HIT ANY KEY"
GOSUB FLUSHKEYS
GOSUB WAITKEY
GOSUB HIDEALL

POKE A.REG, 1
SLEEP:SYS $700
GOSUB WAITKEY
GOSUB SHOWALL
P1=1:R%=15:G%=15:B%=15:GOSUB RGBPAL
COLOR 1
PRINT "DONE"
GOSUB FLUSHKEYS
GOSUB WAITKEY
END




POKEMODE:
 ADDR=$700
 RESTORE MODEDATA
 FOR I= 0 TO 2 STEP 0
   READ BYTE
   IF BYTE > -1 THEN POKE ADDR, BYTE:ADDR=ADDR+1:GOTO NXTI
   I=2
NXTI:
 NEXT I
 RETURN


RGBPAL:
  A=P1*2:X=(G%*16)+B%:A=A+$FA00:SLEEP:VPOKE 1,A,X:A=A+1:SLEEP:VPOKE 1,A,R%:RETURN

FLUSHKEYS:
 GET X$:IF X$<>"" THEN FLUSHKEYS
 RETURN

WAITKEY:
 GET X$:IF X$="{ESC}" THEN END
 IF X$="" THEN WAITKEY
 RETURN


MODEDATA:
 DATA $5A,$DA,$48,$A9,$FA,$8D,$21,$9F,$A9,$11,$8D,$22,$9F,$A9,$00,$8D
 DATA $20,$9F,$A2,$04,$A0,$80,$8D,$23,$9F,$88,$D0,$FA,$CA,$D0,$F5,$20,$DE,$FF
 DATA $85,$29,$CB,$20,$DE,$FF,$C9,$FF,$F0,$F8,$68,$18,$20,$5F,$FF,$FA,$7A,$60,-1


HIDEALL:
  GOSUB HIDEGRAPHICS:GOTO HIDETEXT
SHOWALL:
  GOSUB SHOWGRAPHICS:GOTO SHOWTEXT

HIDEGRAPHICS:
  POKE VERA.DCVIDEO, PEEK(VERA.DCVIDEO) AND LAYER0.OFF:RETURN

SHOWGRAPHICS:
  POKE VERA.DCVIDEO, PEEK(VERA.DCVIDEO) OR LAYER0.ON:RETURN

HIDETEXT:
  POKE VERA.DCVIDEO, PEEK(VERA.DCVIDEO) AND LAYER1.OFF:RETURN

SHOWTEXT:
  POKE VERA.DCVIDEO, PEEK(VERA.DCVIDEO) OR LAYER1.ON:RETURN

SETREGVARS:
  A.REG=$030C:X.REG=$030D:Y.REG=$030E:C.REG=$030F:R0L=2:R0H=3:R0=R0L:R1L=4:R1H=5:R1=R1L:R2L=6:R2H=7:R2=R2L:R3L=8:R3H=9:R3=R3L:R4L=10:R4H=11:R4=R4L
  R15L=$20:R15H=$21:R15=R15L:CHKOUT=$FFC9:CHKIN=$FFC6:CLRCHN=$FFCC:MCIOUT=$FEB1:MACPTR=$FF44:GRAPH.DRAW.IMAGE=$FF38
  VERA.DCVIDEO=$9F29:LAYER0.ON=16:LAYER0.OFF=239:LAYER1.ON=32:LAYER1.OFF=223:FB.CURSOR.POSITION=$FEFF:FB.CURSOR.NEXTLINE=$FF02:TRUE=-1:FALSE=0:RETURN
