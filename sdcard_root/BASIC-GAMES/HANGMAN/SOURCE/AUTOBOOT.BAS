#CONTROLCODES 1
#SYMFILE "@:CONFMENU.SYM"
DEF FN SIGNED.BYTE(N) = N+256*(N>127)
OB = PEEK(1):BANK PEEK(0),0
ROM.VERSION=FN SIGNED.BYTE(PEEK($FF80))
## IF ROM.VERSION < 0 THEN PRINT "PRE-RELEASE ROM"
GOOD.ROM = (ROM.VERSION < -45) OR (ROM.VERSION >= 45)
ROM.VERSION = ABS(ROM.VERSION)
BANK PEEK(0), OB

IF NOT GOOD.ROM THEN PRINT "{GRN}ROM VERSION:{WHT}";ROM.VERSION:DM$="HANGMAN REQUIRES A R45 RELEASE ROM OR LATER!":GOTO ERRORHALT

STARTUP:
DIM S$,F$,DCHAR%(9),NV$(18),NN$(18),NV%,FV%,TC%(2,8),PC%(8,4),MC$(7),DI$(3),PL%(2,1),PL$(2),WN%(2)
PF$="DPAL.BIN":GOSUB SETREGVARS:GOSUB POKENOFLICKER

POKE C.REG,1:SYS $FF5F:IF PEEK(A.REG)<>$80 THEN GOSUB HIDEALL:MYMODE=$80:GOSUB NOFLICKERSCREEN

DIM MUSIC.NAME$(3),ZNUM%(3),USING.LST%(3),ZSM.RANDOM%(3),MUSIC.PAUSED%(3):LS%=-1:X=RND(-RND(.))
PRINT CHR$(15)
GOSUB SETUPTEXTMODE

POKE C.REG,1:SYS $FF99:LAST.BANK = PEEK(A.REG):IF LAST.BANK=0 THEN LAST.BANK=256
LAST.BANK = LAST.BANK-1:BANKS.AVAILABLE = LAST.BANK-10:NEXT.BANK=2


  GOSUB VARINIT



CONFMENU:
  MOUSE 1
  GOSUB HIDEALL:CLS:GOSUB SETDEFPAL:GOSUB SETDRAWPAL:S$="HANGMAN - STARTUP Options":GOSUB GMENUBACK
  IF CH<1 OR CH>6 THEN CH=1
  X=8:Y=5:DI=2
  FOR I=1 TO 3
    Y=Y+3:LOCATE Y,X:COLOR 1,0:PRINT RIGHT$(STR$(I),1);:PRINT ":{PUR}"MC$(I);
  NEXT I
  W=35:H=14:C1=1:C2=$17:C3=$C2:C4=$1E:L$="ENTER":X=57:Y=132:GOSUB DRAWBTN:LOCATE 18,13:S$="{PUR}To Confirm Choice":GOSUB PETCHK
  PRINT S$;
  GOSUB SHOWALL


MENUSHOW:
  IF CH=3 THEN Y=14
  IF CH=2 THEN Y=11
  IF CH=1 THEN Y=8
  LOCATE Y,8:COLOR 7,4:PRINT CHR$(DCHAR%(9));" ";:PRINT"{WHT}";MC$(CH);RPT$(32,22-LEN(MC$(CH)));:COLOR 1,0

MENUGET:
  GET X$:RA=MWHEEL:IF MB<>1 AND RA=0 THEN SKIPMOUSE3
  CX=MX:CY=MY:I=1:MC%=0

CHKMOUSE:
  IF RA<0 THEN X$=CHR$(145)
  IF RA>0 THEN X$=CHR$(17)
  IF X$<>"" THEN ENDMOUSE
  MC%=(CX>=PC%(I,1)) AND (CX<=PC%(I,3)) AND (CY>=PC%(I,2)) AND (CY<=PC%(I,4))
  IF NOT MC% THEN I=I+1:IF I>4 THEN X$="Z":GOTO ENDMOUSE
  IF NOT MC% THEN X$="":GOTO CHKMOUSE
  IF I<4 THEN X$=RIGHT$(STR$(I),1)
  IF I=4 THEN X$="{CR}"
ENDMOUSE:
  IF MB<>0 THEN ENDMOUSE

SKIPMOUSE3:
  IF X$="" THEN MENUGET
  CX=ASC(X$)
  LOCATE Y,8:COLOR 1,0:PRINT RIGHT$(STR$(CH),1);
  PRINT ":{PUR}"MC$(CH);RPT$(32,28-LEN(MC$(CH)));
  SAVECH=CH
  IF CH=3 AND CX=27 THEN CX=13
  IF CX=27 THEN CH=3
  IF CX>=49 AND CX<=55 THEN CH=VAL(X$)
  IF CX=145 THEN CH=CH-1
  IF CX=17 THEN CH=CH+1
  IF CX=13 THEN L$="ENTER":W=35:H=14:X=57:Y=132:GOSUB PUSHBTN:GOTO DOMENUCHOICE
  IF CH>3 THEN CH=1
  IF CH<1 THEN CH=3
  IF SAVECH=CH THEN GOSUB BOING
  IF SAVECH<>CH THEN GOSUB CLICK
  GOTO MENUSHOW

DOMENUCHOICE:
  IF CH=3 THEN CLEANUP
  IF CH=1 OR CH=2 THEN GOSUB HIDEALL:CLS:RECT 0,0,XLIMIT,YLIMIT,0:DOS "CD:HANGMAN"
  IF CH=2 THEN LOAD "CONFMENU.PRG"
  IF CH=1 THEN LOAD "HANGMAN.PRG"

  GOSUB BOING:GOTO MENUSHOW

ADJUSTPETLOWER:
 IF CC>=193 AND CC<=218 THEN CC=CC-128:X$=CHR$(CC)
 RETURN

GMENUBACK:
  RECT 0,0,XLIMIT,YLIMIT,$10:GOSUB FRAMESCRN:RECT 40,23,263,160,6:FRAME 43,37,260,157,12:RECT 45,39,258,155,12:CHAR 60,34,1,CHR$($0C)+S$:RETURN

##  FRAMESCRN:
##  X1=5:Y1=9:X2=312:Y2=219:CC=$1C:FOR J=1 TO 6:FRAME X1,Y1,X2,Y2,CC:X1=X1+1:X2=X2-1:Y1=Y1+1:Y2=Y2-1:CC=CC-2:NEXT J:RETURN

FRAMESCRN:
  X1=34:Y1=17:X2=269:Y2=166:CC=$1C
  FOR J=1 TO 6:FRAME X1,Y1,X2,Y2,CC:X1=X1+1:X2=X2-1:Y1=Y1+1:Y2=Y2-1:CC=CC-2:NEXT J
  RETURN

PUSHBTN:
  C1=$17:C2=1:C3=$61:C4=$10:GOSUB DRAWBTN:GOSUB CLICK:SLEEP 5:C1=1:C2=$17:C3=$C2:C4=$1E:GOTO DRAWBTN


DRAWBTN:
     IF H=0 THEN H=W:I=-1
     X1=X+1:XW=X+W:YW=Y+H:Y1=Y+1:Y5=YW-1:X5=XW-1:LINE X,Y,XW,Y,C1:LINE X1,Y1,X5,Y1,C1:LINE XW,Y,XW,YW,C1:LINE X5,Y1,X5,Y5,C1
     LINE X,Y,X,YW,C2:LINE X1,Y1,X1,Y5,C2:LINE X,YW,X,YW,C2:LINE X,YW,X5,YW,C2:LINE X,Y5,XW-2,Y5,C2:RECT X+2,Y+2,XW-2,YW-2,C3:AX=4
## DRAW THE LETTER ON THE BTN
     CHAR X+AX,YW-3,C4,L$
    RETURN

RESETCIRCLE:
  XSQUISH=1:YSQUISH=1:Q1=1:Q2=1:Q3=1:Q4=1:FILL=0:RETURN


SETUPTEXTMODE:
  GOSUB GETCHARMODE:IF NOT ISO.ON THEN SKIPISO
ISOFONTS:
  PETSCII=FALSE
  GOSUB LOADFONTS
  F$=FONT1$:GOSUB FILEEXISTS:F=FE%:F$=FONT2$:GOSUB FILEEXISTS:F2=FE%
  IF NOT (F2 OR F) THEN SKIPISO
  IF F AND (NOT F2) THEN FONT2$=FONT1$
  IF F2 AND (NOT F) THEN FONT1$=FONT2$
  FONTFILE$=FONT1$
  GOTO LOADISOFONT

LOADFONTS:
  RESTORE FONTNAMES:READ FONT1$:READ FONT2$:RETURN


SKIPISO:
  PETSCII=TRUE
PETSCIIMODE:
  PRINT "{ISO OFF}{UPPER}":GOSUB PETDRAW:ISO.ON=FALSE:GOTO THINFONT

SETISOMODE:
  PRINT "{ISO ON}":ISO.ON=TRUE:GOTO ISODRAW

LOADISOFONT:
  BVLOAD FONTFILE$,8,1,$F000:GOSUB FIXCURSOR

COPYDIAMOND:
 OB=PEEK(1):BANK PEEK(0),6:CA=$C2D0:VA=$F748:FOR I=0 TO 7:X=PEEK(CA+I):VPOKE 1,VA+I,X:NEXT I:BANK PEEK(0),OB:RETURN

FIXCURSOR:
  FBASE=$9F*8+$F000
  FOR X=0 TO 5:VPOKE 1,FBASE+X,0:NEXT X
  VPOKE 1,FBASE+6,$FF:VPOKE 1,FBASE+7,$FF

SETDRAWCHARS:
  IF ISO.ON THEN ISODRAW
  GOTO PETDRAW

ISODRAW:
  RESTORE ISODATA:GOTO READCHAR

PETDRAW:
  RESTORE PETDATA
READCHAR:
  FOR I=1 TO 9:READ DCHAR%(I):NEXT I:RETURN

PETDATA:
  DATA $6F,$A3,$70,$A5,$A7,$6C,$A4,$BA,$7A

ISODATA:
  DATA $C9,$CD,$BB,$BA,$BA,$C8,$CD,$BC,$E9

GETCHARMODE:
   ISO.ON=(PEEK($372) AND %01000000) <> 0:RETURN


AREACLR:
  LOCATE Y,X:PRINT RPT$(32,ML);:LOCATE Y,X:RETURN

CLICK:
  FMDRUM 7,26:RETURN

BOING:
  FMDRUM 7,87:RETURN

FLUSHKEYS:
   GET X$:IF X$<>"" THEN FLUSHKEYS
   RETURN


FONTNAMES:
  DATA "HANGMAN/FONTS/THINSS.PF","HANGMAN/FONTS/READABLE.PF"


FILEEXISTS:
  X$=F$:FE%=0:X$=X$+",S,R":OPEN 2,8,2,X$:CLOSE 2:OPEN 15,8,15:INPUT#15,X,X$:CLOSE 15:FE%=(X<=20):RETURN


HIDEALL:
  GOSUB HIDEGRAPHICS:GOTO HIDETEXT
SHOWALL:
  GOSUB SHOWGRAPHICS:GOTO SHOWTEXT

HIDEGRAPHICS:
  POKE VERA.DCVIDEO, PEEK(VERA.DCVIDEO) AND LAYER0.OFF:RETURN

SHOWGRAPHICS:
  POKE VERA.DCVIDEO, PEEK(VERA.DCVIDEO) OR LAYER0.ON:RETURN

HIDETEXT:
  POKE VERA.DCVIDEO, PEEK(VERA.DCVIDEO) AND LAYER1.OFF:RETURN

SHOWTEXT:
  POKE VERA.DCVIDEO, PEEK(VERA.DCVIDEO) OR LAYER1.ON:RETURN

RGBPAL:
  A=P1*2:X=(G%*16)+B%:A=A+$FA00:VPOKE 1,A,X:A=A+1:VPOKE 1,A,R%:RETURN

COPYPALET:
  VPOKE 1,$FA00+(P2*2),VPEEK(1,$FA00+(P1*2)):VPOKE 1,$FA00+(P2*2)+1,VPEEK(1,$FA00+(P1*2)+1):RETURN

SETDEFPAL: 
  F$="DPAL.BIN":GOSUB FILEEXISTS
  IF FE% THEN BVLOAD F$,8,1,$FA00:RETURN
  POKE $9F20,0
  POKE $9F21,$FA
  POKE $9F22,%00010001
  RESTORE PALDATA
  FOR I=1 TO 512:READ P:POKE $9F23, P:NEXT
  RETURN


PALDATA:
DATA 0,0,255,15,0,8,254,10,76,12,197,0,10,0,231,14,133,13,64,6,119,15,51,3,119,7,246,10,143,0,187,11,0,0,17,1,34,2,51,3,68,4,85,5,102,6,119,7,136,8,153,9,170,10,187,11,204,12,221,13,238
DATA 14,255,15,17,2,51,4,68,6,102,8,136,10,153,12,187,15,17,2,34,4,51,6,68,8,85,10,102,12,119,15,0,2,17,4,17,6,34,8,34,10,51,12,51,15,0,2,0,4,0,6,0,8,0,10,0,12,0,15,33,2,67,4,100,6,134,8
DATA 168,10,201,12,235,15,17,2,50,4,83,6,116,8,149,10,182,12,215,15,16,2,49,4,81,6,98,8,130,10,163,12,195,15,16,2,48,4,64,6,96,8,128,10,144,12,176,15,33,1,67,3,100,5,134,7,168,9,201,11,251
DATA 13,33,1,66,3,99,4,132,6,165,8,198,9,247,11,32,1,65,2,97,4,130,5,162,6,195,8,243,9,32,1,64,2,96,3,128,4,160,5,192,6,240,7,33,1,67,3,101,4,134,6,168,8,202,9,252,11,33,1,66,2,100,3,133
DATA 4,166,5,200,6,249,7,32,0,65,1,98,1,131,2,164,2,197,3,246,3,32,0,65,0,97,0,130,0,162,0,195,0,243,0,34,1,68,3,102,4,136,6,170,8,204,9,255,11,34,1,68,2,102,3,136,4,170,5,204,6,255,7,34
DATA 0,68,1,102,1,136,2,170,2,204,3,255,3,34,0,68,0,102,0,136,0,170,0,204,0,255,0,18,1,52,3,86,4,104,6,138,8,172,9,207,11,18,1,36,2,70,3,88,4,106,5,140,6,159,7,2,0,20,1,38,1,56,2,74,2,92
DATA 3,111,3,2,0,20,0,22,0,40,0,42,0,60,0,63,0,18,1,52,3,70,5,104,7,138,9,156,11,191,13,18,1,36,3,54,4,72,6,90,8,108,9,127,11,2,1,20,2,22,4,40,5,42,6,60,8,63,9,2,1,4,2,6,3,8,4,10,5,12,6
DATA 15,7,18,2,52,4,70,6,104,8,138,10,156,12,190,15,17,2,35,4,53,6,71,8,89,10,107,12,125,15,1,2,19,4,21,6,38,8,40,10,58,12,60,15,1,2,3,4,4,6,6,8,8,10,9,12,11,15


VARINIT:
  GOSUB SETDRAWCHARS:GOSUB SETREGVARS:FMINIT:XLIMIT=319:YLIMIT=239:UC%=-1:ZCVOLUME=15:VOLUME=100

  I$="SHOWCLUE":GOSUB GETINIVALUE:IF I$="0" THEN UC%=FALSE

  Q1=1:Q2=1:Q3=1:Q4=1:XSQUISH=1:YSQUISH=1:MW%=20:MC%=35:PUTIMAGE=FALSE:LEGCOLOR=$46:BLACK2=$10

  RESTORE GAMEMENUTEXT
    FOR CX=1 TO 3
       READ S$:IF PETSCII THEN GOSUB UCASE
       MC$(CX)=S$:NEXT CX
    DI$(1)="EASY":DI$(2)="MEDIUM":DI$(3)="HARD"

   RESTORE CONTROLS:FOR I=1 TO 4:FOR C=1 TO 4:READ PC%(I,C):NEXT C:NEXT I

   W=34:H=14:C1=1:C2=$17:C3=$C2:C4=$1E:L$="ENTER":X=57:Y=132:

CONTROLS:
  DATA 56,56,184,64
  DATA 56,80,240,88
  DATA 56,104,240,112
  DATA 57,132,91,146

GAMEMENUTEXT:
  DATA "HANGMAN - Game","HANGMAN - Config Menu","EXIT To Commander X16"

SETDRAWPAL:
  P1=$25:P2=$FF:GOSUB COPYPALET:P1=1:P2=$FE:GOSUB COPYPALET:P1=$3B:P2=$FD:GOSUB COPYPALET:P1=$10:P2=4:GOSUB COPYPALET:P1=$1A:P2=12:GOSUB COPYPALET:RETURN

NOFLICKERSCREEN:
 POKE A.REG, MYMODE
 SYS $410
 IF MYMODE=$80 THEN RECT 0,0,319,239,0
 RETURN

POKENOFLICKER:
  RESTORE NOFLICKER
  FOR A=$410 TO $443
      READ C:POKE A,C
  NEXT A
  RETURN

## 52 BYTES
NOFLICKER:
 DATA $5A,$DA,$48,$A9,$FA,$8D,$21,$9F,$A9,$11,$8D,$22,$9F,$A9,$00,$8D
 DATA $20,$9F,$A2,$04,$A0,$80,$8D,$23,$9F,$88,$D0,$FA,$CA,$D0,$F5,$20,$DE,$FF
 DATA $85,$29,$CB,$20,$DE,$FF,$C9,$FF,$F0,$F8,$68,$18,$20,$5F,$FF,$FA,$7A,$60


SETREGVARS:
  A.REG=$030C:X.REG=$030D:Y.REG=$030E:C.REG=$030F:R0L=2:R0H=3:R0=R0L:R1L=4:R1H=5:R1=R1L
  R15L=$20:R15H=$21:R15=R15L:CHKOUT=$FFC9:CHKIN=$FFC6:CLRCHN=$FFCC:MCIOUT=$FEB1:MACPTR=$FF44
  VERA.DCVIDEO=$9F29:LAYER0.ON=16:LAYER0.OFF=239:LAYER1.ON=32:LAYER1.OFF=223:FB.CURSOR.POSITION=$FEFF:FB.CURSOR.NEXTLINE=$FF02:TRUE=-1:FALSE=0:RETURN

GETZPSTRING:
  X=$500:I=X+32:ZP.STRING$=""
ZLOOP:
  Z=PEEK(X):IF Z=0 THEN RETURN
  ZP.STRING$=ZP.STRING$ + CHR$(Z):X=X+1
  IF X < I THEN ZLOOP
  RETURN


PUTZPSTRING:
   IF LEN(ZP.STRING$)<32 AND LEN(ZP.STRING$)>0 THEN DOZPUT
   IF LEN(ZP.STRING$)=0 THEN POKE R0, 0:RETURN
   PRINT " STRING TO LONG FOR ZERO REGISTERS (MAX 31 CHARS)":END
DOZPUT:
   ZP1 = $500
   FOR I=1 TO LEN(ZP.STRING$)
       POKE ZP1, ASC(MID$(ZP.STRING$,I,1))
       ZP1=ZP1 + 1
   NEXT I
   POKE ZP1, 0
   RETURN

GETINIVALUE:
   I=1
GETILOOP:
   IF NN$(I)=I$ THEN I$=NV$(I):RETURN
   I=I+1:IF I>NV% THEN I$="":RETURN
   GOTO GETILOOP

READINI:
  NV%=0:FV%=0
  GOSUB FILEEXISTS:IF NOT FE% THEN RETURN
  FF$=F$+ ",S,R":OPEN 4,8,4,FF$
  DOINILOOP:
    LINPUT#4, S$
    IF LEFT$(S$,2)="##" THEN CONTLOOP
    IF LEFT$(S$,3)="REM" THEN CONTLOOP
    GOSUB TRIM:GOSUB UCASE
    IF LEFT$(S$,4)="REM " OR LEFT$(S$,2)="##" OR S$="" OR S$="REM" OR S$="##" THEN CONTLOOP
    PRINT ".";
    GOSUB GETINIVAR
    IF TN$="" THEN CONTLOOP
    IF TV$="ON" OR TV$="YES" THEN TV$="1"
    IF TV$="OFF" OR TV$="NO" THEN TV$="0"
    NV%=NV%+1:NN$(NV%)=TN$:NV$(NV%)=TV$
  CONTLOOP:
  IF ST=0 AND NV%<18 THEN DOINILOOP
  CLOSE 4:FV%=(NV%>0):PRINT:RETURN

GETINIVAR:
  SC$="":TN$="":TV$="":J=1
DOINIPARSE:
  X$=MID$(S$,J,1):IF X$="=" THEN GOTINI
  SC$=SC$+X$:J=J+1:IF J>LEN(S$) THEN ENDINI
  GOTO DOINIPARSE
GOTINI:
  J=J+1:TT$=S$:S$=SC$:SC$=""
  GOSUB RTRIM:TN$=S$:S$=TT$
VALUEPARSE:
  X$=MID$(S$,J,1):SC$=SC$+X$
  J=J+1:IF J>LEN(S$) THEN ENDINI
  GOTO VALUEPARSE
ENDINI:
  TT$=S$:S$=SC$:GOSUB TRIM:TV$=S$:S$=TT$:RETURN

PETCHK:
  IF ISO.ON THEN RETURN

UCASE:
  IF S$="" THEN RETURN
  X$="":FOR I=1 TO LEN(S$):I$=MID$(S$,I,1):X=ASC(I$):IF X>=97 AND X<=122 THEN X=X-32
  X$=X$+CHR$(X):NEXT I:S$=X$:RETURN

TRIM:
  GOSUB LTRIM:GOTO RTRIM

LTRIM:
   IF S$="" THEN RETURN
   I=1:C1=0
DOLOOP:
   X$=MID$(S$,I,1):X=ASC(X$):IF X > 32 THEN LSTR
   C1=C1+1:I=I+1:IF I>LEN(S$) THEN LSTR
   GOTO DOLOOP
LSTR:
   IF C1=LEN(S$) THEN S$=""
   IF C1>0 AND C1<LEN(S$) THEN S$=MID$(S$,C1+1,LEN(S$)-C1)
   RETURN

RTRIM:
  IF S$="" THEN RETURN
  I=LEN(S$):C1=0
DOLOOPR:
  X$=MID$(S$,I,1):X=ASC(X$):IF X>32 THEN RSTR
  C1=C1+1:I=I-1:IF I<1 THEN RSTR
  GOTO DOLOOPR
RSTR:
  IF C1=LEN(S$) THEN S$=""
  IF C1>0 AND C1<LEN(S$) THEN S$=MID$(S$,1,LEN(S$)-C1)
  RETURN

CLSGRAPH:
  GOSUB HIDEALL:COLOR 1,0:CLS:RECT 0,0,XLIMIT,YLIMIT,$10:RETURN

ERRORHALT:
  GOSUB CLSGRAPH:P1=5:R%=0:G%=14:B%=2:GOSUB RGBPAL:P1=15:R%=2:G%=2:GOSUB RGBPAL:GOSUB SHOWALL
  PRINT "{CR}{CR}{YEL}  ERROR ENCOUNTERED{WHT}!":PRINT ":{GRN} {CR}";S$;"{WHT}{CR}":END

CLEANUP:
  GOSUB HIDEALL:MYMODE=$01:GOSUB NOFLICKERSCREEN:GOSUB SETDEFPAL
  BANNER:PRINT:PRINT:GOSUB SHOWALL:END

THINFONT:
 IF ISO.ON THEN FONTFILE$=FONT1$:GOSUB LOADISOFONT:GOTO FONTEND
 POKE A.REG,4:GOTO FONTSYS

THICKFONT:
 IF ISO.ON THEN FONTFILE$=FONT2$:GOSUB LOADISOFONT:GOTO FONTEND
 POKE A.REG,2
FONTSYS:
 SYS $FF62
FONTEND:
 RETURN

CLEARMEM:
  FOR A=R0L TO R15H:POKE A,0:NEXT A
  FOR A=$400 TO $40A:POKE A,0:NEXT A
  RETURN
